<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>NeoChat AI (GPT-4o)</title>
<style>
  :root{
    --bg:#0b0b10; --panel:#12121a; --accent:#8a5cf6; --accent-2:#b598ff;
    --text:#e8e8f5; --muted:#a8a8c0; --bubble:#191925; --user:#27273a;
    --radius:16px;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font:15px/1.5 system-ui,Segoe UI,Roboto,Helvetica,Arial}
  .app{display:grid;grid-template-columns:260px 1fr;min-height:100svh}
  aside{background:var(--panel);border-right:1px solid #1f1f2b;padding:16px;display:flex;flex-direction:column;gap:14px}
  .brand{display:flex;align-items:center;gap:10px;font-weight:700}
  .dot{width:10px;height:10px;border-radius:50%;background:var(--accent)}
  .newchat{background:var(--accent);border:0;color:white;padding:10px 12px;border-radius:12px;cursor:pointer;font-weight:600}
  .ghost{background:transparent;border:1px solid #2d2d44;color:var(--text);padding:8px 10px;border-radius:12px;cursor:pointer}
  .history{display:flex;flex-direction:column;gap:6px;max-height:55vh;overflow:auto;margin-top:6px}
  .hitem{display:flex;justify-content:space-between;align-items:center;background:#1a1a25;border:1px solid #26263a;padding:10px;border-radius:12px;cursor:pointer}
  .hitem span{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:170px}
  main{display:grid;grid-template-rows:auto 1fr auto;min-width:0}
  header{padding:22px;border-bottom:1px solid #1f1f2b;display:flex;justify-content:space-between;align-items:center}
  .title{font-size:22px;font-weight:800}
  .tips{display:flex;flex-wrap:wrap;gap:8px;padding:18px 22px}
  .chip{background:#1b1b28;border:1px solid #26263a;color:var(--muted);padding:8px 10px;border-radius:999px;cursor:pointer}
  .chat{padding:18px 22px;overflow-y:auto;display:flex;flex-direction:column;gap:12px}
  .msg{display:flex;gap:12px;align-items:flex-start}
  .bubble{background:var(--bubble);padding:12px 14px;border-radius:var(--radius);max-width:820px;white-space:pre-wrap;word-wrap:break-word}
  .me .bubble{background:var(--user)}
  .avatar{min-width:36px;height:36px;border-radius:12px;background:#22223a;display:grid;place-items:center;color:var(--accent-2);font-weight:800}
  .composer{padding:16px 22px;border-top:1px solid #1f1f2b;display:flex;gap:10px}
  .composer input{flex:1;background:#141422;border:1px solid #24243a;border-radius:12px;padding:14px;color:var(--text);outline:none}
  .send{background:var(--accent);border:0;color:white;padding:0 18px;border-radius:12px;font-weight:700;cursor:pointer}
  .small{font-size:12px;color:var(--muted)}
  a{color:var(--accent-2);text-decoration:none}
  .welcome{margin:28px 22px;padding:28px;border:1px solid #1f1f2b;background:#12121a;border-radius:18px;text-align:center}
  .welcome h1{margin:0 0 6px;font-size:28px;color:#bda5ff}
  .welcome p{margin:0;color:var(--muted)}
  @media (max-width:900px){ .app{grid-template-columns:1fr} aside{display:none} }
</style>
</head>
<body>
<div class="app">
  <aside>
    <div class="brand"><div class="dot"></div><div>NeoChat</div></div>
    <button class="newchat" id="newChat">+ New Chat</button>
    <div class="small">Chat History</div>
    <div id="history" class="history"></div>
    <div style="margin-top:auto">
      <button class="ghost" id="clearAll">Clear History</button>
      <div class="small" style="margin-top:8px">Light/Dark</div>
      <button class="ghost" id="toggleTheme">Light Mode</button>
      <div class="small" style="margin-top:8px">Messages are stored locally.</div>
    </div>
  </aside>

  <main>
    <header>
      <div class="title" id="chatTitle">Hi</div>
      <div class="small">Welcome ðŸ‘‹</div>
    </header>

    <div id="welcome" class="welcome">
      <h1>Welcome to NeoChat AI</h1>
      <p>Ask me anything. (Powered by GPT-4o)</p>
      <div class="tips" id="tips">
        <button class="chip">Tell me a story</button>
        <button class="chip">Explain quantum computing</button>
        <button class="chip">Write a poem</button>
        <button class="chip">Help me learn JavaScript</button>
      </div>
    </div>

    <div class="chat" id="chat"></div>

    <div class="composer">
      <input id="input" placeholder="Type your message here..." autocomplete="off" />
      <button class="send" id="send">â†—</button>
    </div>
  </main>
</div>

<script>
const API_MODE = "local"; 
const API_URL = "http://127.0.0.1:5000/gpt"; 
const OPENAI_API_KEY = "YOUR_OPENAI_KEY"; 
const MODEL = "gpt-4o-mini"; 

const chatEl = document.getElementById("chat");
const inputEl = document.getElementById("input");
const sendBtn = document.getElementById("send");
const tipsEl = document.getElementById("tips");
const newChatBtn = document.getElementById("newChat");
const themeBtn = document.getElementById("toggleTheme");
const historyEl = document.getElementById("history");
const clearAllBtn = document.getElementById("clearAll");
const welcome = document.getElementById("welcome");

let chats = JSON.parse(localStorage.getItem("neochat_chats") || "[]");
let currentId = localStorage.getItem("neochat_current") || createChat("Hi");

function createChat(title){
  const id = "c_" + Date.now();
  chats.unshift({ id, title, messages: [] });
  persist();
  drawHistory();
  switchChat(id);
  return id;
}
function switchChat(id){
  currentId = id;
  localStorage.setItem("neochat_current", id);
  render();
}
function persist(){
  localStorage.setItem("neochat_chats", JSON.stringify(chats));
}
function activeChat(){ return chats.find(c=>c.id===currentId); }
function push(role, content){
  const chat = activeChat();
  chat.messages.push({role, content});
  if (role==="user" && chat.messages.length===1) chat.title=content.slice(0,20)||"New chat";
  persist();
  render();
}
function render(){
  const chat = activeChat();
  chatEl.innerHTML = "";
  chat.messages.forEach(m=>{
    const el = document.createElement("div");
    el.className = "msg " + (m.role==="user"?"me":"");
    el.innerHTML = `<div class="avatar">${m.role==="user"?"Me":"AI"}</div><div class="bubble">${m.content}</div>`;
    chatEl.appendChild(el);
  });
  chatEl.scrollTop = chatEl.scrollHeight;
  welcome.style.display = chat.messages.length ? "none" : "";
  drawHistory();
}
function drawHistory(){
  historyEl.innerHTML = "";
  chats.forEach(c=>{
    const div=document.createElement("div");
    div.className="hitem";
    div.innerHTML=`<span>${c.title}</span>`;
    div.onclick=()=>switchChat(c.id);
    historyEl.appendChild(div);
  });
}

// ==== GPT CALL WITH STREAMING EFFECT ====
async function askGPT(prompt){
  try {
    let reply="";
    if(API_MODE==="local"){
      const res=await fetch(API_URL,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({prompt})
      });
      const data=await res.json();
      reply=data.reply;
    } else {
      const res = await fetch("https://api.openai.com/v1/chat/completions", {
        method:"POST",
        headers:{"Content-Type":"application/json","Authorization":`Bearer ${OPENAI_API_KEY}`},
        body:JSON.stringify({model:MODEL,messages:[{role:"user",content:prompt}]})
      });
      const data = await res.json();
      reply = data.choices[0].message.content.trim();
    }
    // Typing animation
    return new Promise(resolve=>{
      let i=0;
      const interval = setInterval(()=>{
        i++;
        activeChat().messages[activeChat().messages.length-1].content=reply.slice(0,i);
        render();
        if(i>=reply.length) clearInterval(interval),resolve(reply);
      },25);
    });
  } catch(e){ return "Error: "+e.message; }
}

// ==== EVENTS ====
sendBtn.onclick=async()=>{
  const text=inputEl.value.trim();
  if(!text) return;
  push("user",text);
  inputEl.value="";
  push("assistant",""); // placeholder
  render();
  await askGPT(text);
  persist();
};

tipsEl.onclick=e=>{
  if(e.target.classList.contains("chip")){
    inputEl.value=e.target.textContent;
    sendBtn.click();
  }
};
newChatBtn.onclick=()=>createChat("New Chat");
clearAllBtn.onclick=()=>{
  chats=[];
  persist();
  createChat("Hi");
};
themeBtn.onclick=()=>{document.body.classList.toggle("light");};
render();
</script>
</body>
</html>
